# ValidGen - GitHub Copilot Instructions

## Project Overview

ValidGen is a **code generation tool** for Go that creates high-performance validators as an alternative to reflection-based validation libraries. It generates validation code at build time by parsing Go structs with `valid` tags and creating corresponding validator functions.

### Core Purpose
- **Performance**: Generate compile-time validation code instead of runtime reflection
- **Compatibility**: Compatible with `github.com/go-playground/validator` tag syntax
- **Code Generation**: Creates `*_validator.go` files with validation functions

## Project Structure & Architecture

```
validgen/
├── main.go                    # CLI entry point - takes path argument
├── validgen/                  # Core code generation package
│   ├── find_files.go         # File discovery and processing
│   ├── parse_file.go         # AST parsing of Go files
│   ├── struct.go             # Struct representation and template generation
│   ├── code_generator.go     # Main code generation orchestration
│   ├── if_code.go            # Validation code building
│   ├── parser_validation.go  # Validation tag parsing
│   └── test_elements.go      # Test condition building
├── types/                    # Common types and error handling
├── _examples/                # Example usage and test cases
└── tests/                    # Integration, unit, and benchmark tests
```

## Code Style & Conventions

### Go Code Standards
- **Package naming**: Use lowercase, single-word package names
- **Function naming**: PascalCase for exported functions, camelCase for internal
- **Error handling**: Always return errors explicitly, use `log.Fatal()` in main package only
- **Struct fields**: PascalCase with appropriate struct tags

### Validation Tag Format
```go
type User struct {
    Name  string `valid:"required,min=2,max=50"`
    Email string `valid:"required,email"`
    Age   int    `valid:"gte=0,lte=120"`
}
```

### Generated Code Patterns
- **File naming**: `{structname}_validator.go` (lowercase)
- **Function naming**: `{StructName}Validate(obj *{StructName}) []error`
- **Header comment**: `// Code generated by ValidGen. DO NOT EDIT.`
- **Package**: Same as source struct package
- **Import**: Always import `github.com/opencodeco/validgen/types` for errors

### Template Structure
```go
// Generated validator functions follow this pattern:
func UserValidate(obj *User) []error {
    var errs []error
    
    // Validation conditions with error accumulation
    if !(condition) {
        errs = append(errs, types.NewValidationError("message"))
    }
    
    return errs
}
```

## Supported Validation Rules

### String Validations
- `required` - Field cannot be empty string
- `eq=value` - Must equal specific value
- `eq_ignore_case=value` - Must equal value (case insensitive)
- `neq=value` - Must not equal specific value  
- `neq_ignore_case=value` - Must not equal value (case insensitive)
- `min=N` - Minimum length N characters
- `max=N` - Maximum length N characters
- `len=N` - Exact length N characters
- `in=val1 val2 val3` - Must be one of specified values

### Numeric Validations
- `required` - Field cannot be zero value
- `gt=N` - Greater than N
- `gte=N` - Greater than or equal to N
- `lt=N` - Less than N
- `lte=N` - Less than or equal to N

## Development Guidelines

### Adding New Validations
1. **Update parser**: Add validation to `expectedValuesCount` map in `parser_validation.go`
2. **Add test elements**: Implement condition building in `test_elements.go`
3. **Add tests**: Create test cases in `tests/endtoend/` directory
4. **Update documentation**: Add to README.md validation list

### Testing Strategy
- **Unit tests**: Test individual validation parsing and code generation
- **Integration tests**: Test complete struct validation generation
- **End-to-end tests**: Test full CLI workflow with real Go files
- **Benchmark tests**: Performance comparison with reflection-based validators

### File Processing Workflow
1. `FindFiles()` - Recursively discover `.go` files
2. `parseFile()` - Parse AST to extract structs with valid tags
3. `generateCode()` - Generate validator functions for valid structs
4. Write `*_validator.go` files in same directories as source

### Error Handling Patterns
- **Validation errors**: Use `types.NewValidationError()` for user-facing errors
- **Internal errors**: Return standard Go errors for development issues
- **Fatal errors**: Use `log.Fatal()` only in main package for CLI errors

### Commit Message Conventions
Follow the [Conventional Commits](https://www.conventionalcommits.org/en/v1.0.0/) pattern for all commit messages:

**Format**: `<type>[optional scope]: <description>`

**Types**:
- `feat` - New features or functionality
- `fix` - Bug fixes
- `docs` - Documentation changes
- `style` - Code style/formatting changes (no logic changes)
- `refactor` - Code refactoring without feature/bug changes
- `test` - Adding or updating tests
- `perf` - Performance improvements
- `build` - Build system or dependency changes
- `ci` - CI/CD configuration changes
- `chore` - Maintenance tasks

**Examples**:
- `feat: add support for email validation tag`
- `fix: handle empty strings in min/max validation`
- `docs: update README with new validation examples`
- `test: add benchmark tests for string validations`
- `refactor(parser): simplify validation tag parsing logic`

## Best Practices for Contributors

### Code Generation
- **Template driven**: Use Go templates for consistent code generation
- **Type awareness**: Handle different Go types (string, numeric, custom types)
- **Package preservation**: Generated code must be in same package as source
- **Import management**: Only import necessary packages in generated code

### Performance Considerations
- **No reflection**: Generated code should never use reflection
- **Minimal allocations**: Efficient error collection and string operations
- **Compile-time validation**: All validation logic determined at generation time

### Testing Requirements
- **Generated code tests**: Verify generated validators work correctly
- **Cross-package support**: Test structs in different packages
- **Edge cases**: Empty structs, no validation tags, invalid tags
- **Performance benchmarks**: Compare against reflection-based alternatives

### Documentation Standards
- **Generated code comments**: Include generation warning in all generated files
- **Function documentation**: Document validation functions if exported
- **Example usage**: Provide clear examples in `_examples/` directory

## CLI Usage Patterns

```bash
# Generate validators for all Go files in directory
./bin/validgen /path/to/project

# Typical development workflow
make build                    # Build the binary
make endtoendtests            # Run full test suite
make benchtests               # Run performance benchmarks
```

## When Working on ValidGen

1. **Always regenerate test validators** after code changes using `make endtoendtests`
2. **Run benchmarks** to ensure performance improvements with `make benchtests`
3. **Test multiple packages** - structs in different packages should work correctly
4. **Validate generated code** - ensure it compiles and passes tests
5. **Maintain compatibility** - keep validator tag syntax compatible where possible

## Important Notes

- **Early stage project**: Not suitable for production use yet
- **Go version**: Requires Go 1.24 or higher
- **Template-based**: Core generation logic uses Go text templates
- **Error accumulation**: Validators return slice of errors, not single error
- **Zero values**: Different types have different "required" validation logic
